<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒã‚¤ãƒ³ãƒˆç®¡ç†ã‚µã‚¤ãƒˆ</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    label { display: block; margin-top: 10px; }
    input { width: 100%; padding: 5px; margin-bottom: 10px; }
    button { margin: 5px 0; padding: 10px; width: 100%; font-weight: bold; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    #resetConfirm { display: none; padding: 10px; border: 2px dashed red; margin-top: 10px; background-color: #ffe5e5; }
  </style>
</head>
<body>
  <h2>ğŸ“Š ãƒã‚¤ãƒ³ãƒˆç®¡ç†ã‚µã‚¤ãƒˆ</h2>

  <div>
    <strong>ç¾åœ¨ã®ãƒã‚¤ãƒ³ãƒˆåˆ¸æšæ•°:</strong> <span id="ticketCount">0</span>
  </div>

  <label>ä½¿ç”¨ãƒã‚¤ãƒ³ãƒˆ:</label>
  <input type="number" id="usedPoints" value="0" />

  <label>è¿½åŠ ãƒã‚¤ãƒ³ãƒˆ:</label>
  <input type="number" id="addedPoints" value="0" />

  <button onclick="updateTickets()">ãƒã‚¤ãƒ³ãƒˆæ›´æ–°</button>
  <button onclick="showResetConfirm()" style="background-color: red; color: white;">ãƒªã‚»ãƒƒãƒˆï¼ˆ5ç§’é•·æŠ¼ã—ï¼‰</button>

  <div id="resetConfirm">
    <p>âš ï¸ ã“ã®ãƒœã‚¿ãƒ³ã‚’ <strong>5ç§’é–“é•·æŠ¼ã—</strong> ã™ã‚‹ã¨ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚</p>
    <button id="holdToResetBtn" style="background-color: darkred; color: white;">é•·æŠ¼ã—ã§ç¢ºå®š</button>
    <div id="holdStatus" style="color: gray; margin-top: 5px;"></div>
  </div>

  <table>
    <thead>
      <tr>
        <th>æ—¥ã«ã¡æ™‚é–“</th>
        <th>ä½¿ç”¨</th>
        <th>è¿½åŠ </th>
        <th>åˆè¨ˆåˆ¸</th>
      </tr>
    </thead>
    <tbody id="historyList"></tbody>
  </table>

  <script>
    let ticketCount = 0;
    let history = [];

    window.onload = () => {
      const storedCount = localStorage.getItem("ticketCount");
      const storedHistory = localStorage.getItem("ticketHistory");

      if (storedCount !== null) {
        ticketCount = parseInt(storedCount);
        document.getElementById("ticketCount").textContent = ticketCount;
      }
      if (storedHistory !== null) {
        history = JSON.parse(storedHistory);
        refreshHistory();
      }
    };

    function updateTickets() {
      const used = parseInt(document.getElementById("usedPoints").value) || 0;
      const added = parseInt(document.getElementById("addedPoints").value) || 0;

      const net = added - used;
      const change = Math.floor(net / 5);

      if (ticketCount + change < 0) {
        alert("ãƒã‚¤ãƒ³ãƒˆåˆ¸ãŒè¶³ã‚Šã¾ã›ã‚“");
        return;
      }

      ticketCount += change;
      document.getElementById("ticketCount").textContent = ticketCount;

      const now = new Date().toLocaleString();
      const entry = { time: now, used, added, total: ticketCount };
      history.unshift(entry);

      localStorage.setItem("ticketCount", ticketCount);
      localStorage.setItem("ticketHistory", JSON.stringify(history));

      refreshHistory();
    }

    function refreshHistory() {
      const list = document.getElementById("historyList");
      list.innerHTML = "";
      history.forEach(entry => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${entry.time}</td>
          <td>${entry.used}</td>
          <td>${entry.added}</td>
          <td>${entry.total}</td>
        `;
        list.appendChild(row);
      });
    }

    function showResetConfirm() {
      document.getElementById("resetConfirm").style.display = "block";
    }

    function resetData() {
      localStorage.removeItem("ticketCount");
      localStorage.removeItem("ticketHistory");
      ticketCount = 0;
      history = [];
      document.getElementById("ticketCount").textContent = "0";
      document.getElementById("historyList").innerHTML = "";
      document.getElementById("holdStatus").textContent = "ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸ";
    }

    const holdBtn = document.getElementById("holdToResetBtn");
    const holdStatus = document.getElementById("holdStatus");
    let holdTimer;
    let holdProgress = 0;
    const holdDuration = 5000;

    holdBtn.addEventListener("mousedown", () => {
      holdProgress = 0;
      holdStatus.textContent = "é•·æŠ¼ã—ä¸­...";
      holdTimer = setInterval(() => {
        holdProgress += 100;
        holdStatus.textContent = `${(holdProgress / 1000).toFixed(1)}ç§’...`;
        if (holdProgress >= holdDuration) {
          clearInterval(holdTimer);
          resetData();
          document.getElementById("resetConfirm").style.display = "none";
        }
      }, 100);
    });

    ["mouseup", "mouseleave", "touchend", "touchcancel"].forEach(evt => {
      holdBtn.addEventListener(evt, () => {
        clearInterval(holdTimer);
        if (holdProgress < holdDuration) {
          holdStatus.textContent = "ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸã€‚";
        }
      });
    });
  </script>
</body>
</html>
